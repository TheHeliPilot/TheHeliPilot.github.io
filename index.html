<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Quiz Generator</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Quill Rich Text Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
</head>
<body>
    <!-- Authentication Page -->
    <div id="authPage" class="auth-page">
        <div class="auth-container">
            <div class="auth-box">
                <div class="auth-logo">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <h1>AI Quiz Generator</h1>
                <p class="auth-subtitle">Sign in to start learning</p>

                <!-- Google Login -->
                <button id="googleLoginBtn" class="btn btn-google">
                    <i class="fab fa-google"></i>
                    <span>Sign in with Google</span>
                </button>

                <div class="divider">
                    <span>or continue with email</span>
                </div>

                <!-- Email/Password Form -->
                <form id="authForm" class="auth-form">
                    <div class="form-group">
                        <label for="emailInput">Email</label>
                        <input type="email" id="emailInput" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="passwordInput">Password</label>
                        <input type="password" id="passwordInput" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" id="loginBtn">Sign In</button>
                </form>

                <button id="toggleRegisterBtn" class="btn btn-text">
                    Don't have an account? <strong>Create one</strong>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app hidden">
        <!-- Navigation Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Quiz Gen</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <!-- Dashboard Section -->
                <div class="nav-section">
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </div>

                <!-- Main Navigation Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Main</div>
                    <a href="#" class="nav-link" data-page="projects">
                        <i class="fas fa-folder"></i>
                        <span>Projects</span>
                    </a>
                    <a href="#" class="nav-link" data-page="explore">
                        <i class="fas fa-globe"></i>
                        <span>Explore</span>
                    </a>
                    <a href="#" class="nav-link" data-page="leaderboard">
                        <i class="fas fa-trophy"></i>
                        <span>Leaderboards</span>
                    </a>
                </div>

                <!-- Admin Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Administration</div>
                    <a href="#" class="nav-link hidden" id="devDashboardLink" data-page="dev">
                        <i class="fas fa-tools"></i>
                        <span>Dev Dashboard</span>
                    </a>
                    <a href="#" class="nav-link hidden" id="adminDashboardLink" data-page="admin">
                        <i class="fas fa-shield-alt"></i>
                        <span>Admin Console</span>
                    </a>
                </div>

                <!-- Account Section -->
                <div class="nav-section">
                    <a href="#" class="nav-link" data-page="account">
                        <i class="fas fa-user-circle"></i>
                        <span>Account</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <button id="logoutBtn" class="btn btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Mobile Sidebar Backdrop -->
        <div id="sidebarBackdrop" class="sidebar-backdrop"></div>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <button id="menuToggle" class="menu-toggle" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 id="pageTitle">Dashboard</h2>
                <div class="top-bar-actions">
                    <div class="user-menu">
                        <button class="user-avatar" id="userMenuBtn">
                            <i class="fas fa-user-circle"></i>
                            <span id="userDisplayName">User</span>
                            <span id="proBadge" class="pro-badge hidden">
                                <i class="fas fa-crown"></i>
                                PRO
                            </span>
                            <span id="devBadge" class="dev-badge hidden">
                                <i class="fas fa-tools"></i>
                                DEV
                            </span>
                            <span id="adminBadge" class="admin-badge hidden">
                                <i class="fas fa-shield-alt"></i>
                                ADMIN
                            </span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page active">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalProjects">0</div>
                            <div class="stat-label">Projects</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalCards">0</div>
                            <div class="stat-label">Total Cards</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="studyStreak">0</div>
                            <div class="stat-label">Day Streak</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Cards by Difficulty</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        <div style="background: rgba(29, 185, 84, 0.1); border: 2px solid #1db954; border-radius: 12px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: #1db954;" id="easyCards">0</div>
                            <div style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem;">○ Easy</div>
                        </div>
                        <div style="background: rgba(255, 173, 102, 0.1); border: 2px solid #ffad66; border-radius: 12px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: #ffad66;" id="mediumCards">0</div>
                            <div style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem;">◐ Medium</div>
                        </div>
                        <div style="background: rgba(255, 92, 92, 0.1); border: 2px solid #ff5c5c; border-radius: 12px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: #ff5c5c;" id="hardCards">0</div>
                            <div style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem;">● Hard</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Recent Projects</h3>
                    <div id="recentProjects" class="projects-list">
                        <div class="empty-state">
                            <i class="fas fa-folder-open"></i>
                            <p>No projects yet. Create your first project to get started!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects Page -->
            <div id="projectsPage" class="page">
                <div class="page-header">
                    <button id="createProjectBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        New Project
                    </button>
                </div>
                <div id="projectsList" class="projects-grid">
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>No projects yet. Create one to organize your cards!</p>
                    </div>
                </div>
            </div>

            <!-- Project Detail Page -->
            <div id="projectDetailPage" class="page">
                <div class="page-header">
                    <button id="backToProjectsBtn" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i>
                        Back to Projects
                    </button>
                    <h2 id="projectDetailTitle">Project Name</h2>
                    <div class="actions-group">
                        <button id="startStudyModeBtn" class="btn btn-primary">
                            <i class="fas fa-book-open"></i>
                            Start Study Session
                        </button>
                        <button id="startProjectTestBtn" class="btn btn-primary">
                            <i class="fas fa-play"></i>
                            Start Test
                        </button>
                    </div>
                </div>

                <!-- Project Tabs -->
                <div class="project-tabs">
                    <button class="project-tab active" data-tab="notes">
                        <i class="fas fa-file-alt"></i>
                        Notes
                    </button>
                    <button class="project-tab" data-tab="testCards">
                        <i class="fas fa-layer-group"></i>
                        Test Cards
                    </button>
                    <button class="project-tab" data-tab="studyCards">
                        <i class="fas fa-brain"></i>
                        Study Cards
                    </button>
                    <button class="project-tab" data-tab="mindMap">
                        <i class="fas fa-project-diagram"></i>
                        Mind Map
                    </button>
                </div>

                <!-- Notes Tab -->
                <div id="notesTab" class="project-tab-content active">
                    <div class="notes-toolbar">
                        <div class="notes-toolbar-left">
                            <button id="addNoteFileBtn" class="btn btn-primary" style="display: inline-flex !important; align-items: center !important; justify-content: center !important; gap: 0.5rem; text-align: center;">
                                <i class="fas fa-file-plus"></i>
                                <span>New Note File</span>
                            </button>
                        </div>
                        <div class="notes-toolbar-right">
                            <input type="file" id="importNotesFile" accept=".pdf,.docx,.txt,.md" style="display: none;">
                            <button id="importNotesBtn" class="btn btn-secondary">
                                <i class="fas fa-file-import"></i>
                                Import File
                            </button>
                            <button id="regenerateProjectBtn" class="btn btn-primary">
                                <i class="fas fa-sync-alt"></i>
                                Regenerate Project
                            </button>
                        </div>
                    </div>

                    <!-- Notes Layout: File Browser -->
                    <div id="notesBrowser" style="padding: 1rem;">
                        <!-- Sorting Controls -->
                        <div class="notes-sort-header">
                            <div class="notes-sort-controls">
                                <i class="fas fa-sort" style="color: var(--text-muted);"></i>
                                <span style="color: var(--text-muted); font-size: 0.875rem; font-weight: 500;">Sort by:</span>
                                <select id="noteSortSelect" class="text-input notes-sort-select">
                                    <option value="date">Last Modified</option>
                                    <option value="date-asc">Oldest First</option>
                                    <option value="alpha">A → Z</option>
                                    <option value="alpha-desc">Z → A</option>
                                    <option value="size">Size (Largest)</option>
                                    <option value="size-asc">Size (Smallest)</option>
                                </select>
                            </div>
                            <div class="notes-count">
                                <span id="noteCountDisplay">0 notes</span>
                            </div>
                        </div>

                        <!-- Note Files Grid -->
                        <div id="noteFilesList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;">
                            <!-- Note files will be rendered here as cards -->
                        </div>
                    </div>
                </div>

                <!-- Test Cards Tab -->
                <div id="testCardsTab" class="project-tab-content">
                    <div class="page-header">
                        <button id="addTestCardBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Add Test Card
                        </button>
                    </div>
                    <div id="testCardsList" class="cards-grid">
                        <div class="empty-state">
                            <i class="fas fa-layer-group"></i>
                            <p>No test cards yet. Add cards or regenerate the project!</p>
                        </div>
                    </div>
                </div>

                <!-- Study Cards Tab -->
                <div id="studyCardsTab" class="project-tab-content">
                    <div class="page-header">
                        <button id="addStudyCardBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Add Study Card
                        </button>
                    </div>
                    <div id="studyCardsList" class="cards-grid">
                        <div class="empty-state">
                            <i class="fas fa-brain"></i>
                            <p>No study cards yet. Regenerate the project to create study cards!</p>
                        </div>
                    </div>
                </div>

                <!-- Mind Map Tab -->
                <div id="mindMapTab" class="project-tab-content">
                    <!-- Analytics Stats -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
                        <div style="padding: var(--spacing-md); background: var(--surface); border-radius: var(--radius-md); border-left: 4px solid #43e97b;">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">MASTERED</div>
                            <div id="masteredCount" style="font-size: 1.5rem; font-weight: 600; color: #43e97b;">0</div>
                        </div>
                        <div style="padding: var(--spacing-md); background: var(--surface); border-radius: var(--radius-md); border-left: 4px solid #48dbfb;">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">GOOD</div>
                            <div id="goodCount" style="font-size: 1.5rem; font-weight: 600; color: #48dbfb;">0</div>
                        </div>
                        <div style="padding: var(--spacing-md); background: var(--surface); border-radius: var(--radius-md); border-left: 4px solid #feca57;">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">LEARNING</div>
                            <div id="learningCount" style="font-size: 1.5rem; font-weight: 600; color: #feca57;">0</div>
                        </div>
                        <div style="padding: var(--spacing-md); background: var(--surface); border-radius: var(--radius-md); border-left: 4px solid #ff6b6b;">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">NEEDS REVIEW</div>
                            <div id="weakCount" style="font-size: 1.5rem; font-weight: 600; color: #ff6b6b;">0</div>
                        </div>
                    </div>
                    <div id="mindMapInstructions" style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--surface-light); border-radius: var(--radius-md); display: flex; gap: var(--spacing-md); align-items: center;">
                        <i class="fas fa-info-circle" style="color: var(--primary);"></i>
                        <span style="color: var(--text-secondary); font-size: 0.875rem;">
                            <strong>Interactive Map:</strong> <span class="desktop-instructions">Colored borders show mastery level • Scroll to zoom • Drag to pan • Hover or Tap nodes to view description</span><span class="mobile-instructions" style="display: none;">Pinch to zoom • Drag to pan • Tap nodes to view details</span>
                        </span>
                    </div>
                    <div id="projectMindMapContainer" style="width: 100%; height: calc(100vh - 380px); background: var(--background); border: 1px solid var(--border); border-radius: var(--radius-lg); position: relative;">
                        <svg id="projectMindMapSvg" style="width: 100%; height: 100%;"></svg>
                        <div id="projectMindMapTooltip" style="position: absolute; padding: 1rem; background: var(--surface); border: 2px solid var(--primary); border-radius: var(--radius-md); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.7); pointer-events: none; opacity: 0; transition: opacity 0.2s; max-width: 400px; z-index: 1000; backdrop-filter: blur(8px);">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary); font-size: 1rem; font-weight: 600;"></h4>
                            <p style="margin: 0; color: var(--text-primary); font-size: 0.875rem; line-height: 1.5;"></p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Study Mode Page -->
            <div id="studyModePage" class="page">
                <div class="page-header">
                    <h2 id="studyModeTitle" style="margin: 0;">Study Session</h2>
                </div>

                <div id="studyModeContainer" style="max-width: 800px; margin: 0 auto; padding: var(--spacing-xl);">

                    <!-- Study Card Display -->
                    <div id="studyModeCard" style="position: relative;">
                        <!-- Exit Button (Top Right) -->
                        <div style="display: flex; justify-content: flex-end; margin-bottom: var(--spacing-md);">
                            <button id="exitStudyModeBtn" class="btn btn-secondary" style="min-width: 120px;">
                                <i class="fas fa-times"></i>
                                Exit Study
                            </button>
                        </div>

                        <!-- Progress Bar -->
                        <div style="margin-bottom: var(--spacing-lg);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm); color: var(--text-secondary); font-size: 0.875rem;">
                                <span>Progress</span>
                                <span id="studyModeProgress">0 / 0</span>
                            </div>
                            <div style="height: 8px; background: var(--surface-light); border-radius: 4px; overflow: hidden;">
                                <div id="studyModeProgressBar" style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); width: 0%; transition: width 0.3s ease;"></div>
                            </div>
                        </div>

                        <!-- Swipe Hint -->
                        <div style="text-align: center; margin-bottom: var(--spacing-sm); color: var(--text-muted); font-size: 0.813rem; display: flex; align-items: center; justify-content: center; gap: var(--spacing-sm);">
                            <i class="fas fa-hand-pointer"></i>
                            <span>Swipe or drag cards to navigate</span>
                            <i class="fas fa-arrows-alt-h"></i>
                        </div>

                        <!-- Card Stack Container -->
                        <div id="studyCardContainer" style="position: relative; margin-bottom: var(--spacing-md); min-height: 280px; max-height: 400px; cursor: grab;">
                            <!-- Background Card (for preloading next card) -->
                            <div class="study-card-stack" data-position="back" style="position: absolute; top: 0; left: 0; width: 100%; background: var(--surface); border: 2px solid var(--border); border-radius: var(--radius-xl); padding: 1.5rem; box-shadow: var(--shadow-xl); opacity: 0; pointer-events: none; z-index: 1;"></div>

                            <!-- Active Card -->
                            <div id="activeStudyCard" class="study-card-active" style="position: relative; top: 0; left: 0; background: var(--surface); border: 2px solid var(--border); border-radius: var(--radius-xl); padding: 1.5rem; box-shadow: var(--shadow-xl); z-index: 10;">
                                <!-- Level Badge -->
                                <div style="text-align: center; margin-bottom: var(--spacing-sm);">
                                    <div id="studyCardLevel" style="display: inline-block; padding: 0.375rem 0.75rem; background: var(--primary); color: white; border-radius: var(--radius-md); font-size: 0.75rem;"></div>
                                </div>

                                <!-- Topic -->
                                <h2 id="studyCardTopic" style="color: var(--primary); margin-bottom: var(--spacing-md); font-size: 1.5rem; text-align: center;"></h2>

                                <!-- Divider -->
                                <div style="height: 2px; background: linear-gradient(90deg, transparent, var(--border), transparent); margin: var(--spacing-md) 0;"></div>

                                <!-- Content -->
                                <div id="studyCardContent" style="color: var(--text); font-size: 1rem; line-height: 1.6;"></div>
                            </div>
                        </div>

                        <!-- Button Controls -->
                        <div id="studyModeControls" class="hidden">
                            <!-- Mastery Level Buttons -->
                            <div style="margin-bottom: var(--spacing-md);">
                                <div style="text-align: center; margin-bottom: var(--spacing-sm); color: var(--text-secondary); font-size: 0.875rem;">
                                    How well do you know this?
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-sm);">
                                    <button class="btn mastery-btn" data-mastery="weak" style="background: #ff6b6b; border: none;">
                                        <i class="fas fa-times-circle"></i> Weak
                                    </button>
                                    <button class="btn mastery-btn" data-mastery="learning" style="background: #feca57; border: none;">
                                        <i class="fas fa-book-reader"></i> Learning
                                    </button>
                                    <button class="btn mastery-btn" data-mastery="good" style="background: #48dbfb; border: none;">
                                        <i class="fas fa-thumbs-up"></i> Good
                                    </button>
                                    <button class="btn mastery-btn" data-mastery="mastered" style="background: #43e97b; border: none;">
                                        <i class="fas fa-check-circle"></i> Mastered
                                    </button>
                                </div>
                            </div>

                            <!-- Navigation -->
                            <div style="display: flex; justify-content: space-between; gap: var(--spacing-md);">
                                <button id="studyModePrev" class="btn btn-secondary" style="flex: 1;">
                                    <i class="fas fa-chevron-left"></i>
                                    Previous
                                </button>
                                <button id="studyModeNext" class="btn btn-secondary" style="flex: 1;">
                                    Next
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Complete Message -->
                        <div id="studyModeComplete" class="hidden" style="text-align: center; padding: 3rem;">
                            <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success); margin-bottom: var(--spacing-lg);"></i>
                            <h2 style="color: var(--success); margin-bottom: var(--spacing-md);">Study Session Complete!</h2>
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-xl);">You've reviewed all cards in the hierarchy.</p>
                            <button id="restartStudyModeBtn" class="btn btn-primary">
                                <i class="fas fa-redo"></i>
                                Start Over
                            </button>
                            <button id="closeStudyModeBtn" class="btn btn-secondary" style="margin-left: var(--spacing-md);">
                                <i class="fas fa-times"></i>
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cards Page -->
            <div id="cardsPage" class="page">
                <div class="page-header">
                    <div class="filter-group">
                        <select id="projectFilter" class="select-input">
                            <option value="all">All Projects</option>
                        </select>
                        <select id="difficultyFilter" class="select-input">
                            <option value="all">All Difficulties</option>
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                </div>
                <div id="cardsList" class="cards-grid">
                    <div class="empty-state">
                        <i class="fas fa-layer-group"></i>
                        <p>No cards yet. Open a project and add cards there!</p>
                    </div>
                </div>
            </div>

            <!-- Study Page -->
            <div id="studyPage" class="page">
                <div class="page-header">
                    <h2>Study Materials</h2>
                </div>
                <div class="study-setup">
                    <h3>Select Project to Study</h3>
                    <div class="form-group">
                        <label>Select Project</label>
                        <select id="studyProjectSelect" class="select-input">
                            <option value="">Select a project</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button id="viewStudyListBtn" class="btn btn-primary">
                            <i class="fas fa-list"></i>
                            View Study Cards
                        </button>
                        <button id="viewStudyMindMapBtn" class="btn btn-secondary">
                            <i class="fas fa-project-diagram"></i>
                            View Mind Map
                        </button>
                    </div>
                </div>
            </div>

            <!-- Test Page -->
            <div id="testPage" class="page">
                <div id="testSetup" class="test-setup">
                    <h3>Start a Test</h3>
                    <div class="form-group">
                        <label>Select Project</label>
                        <select id="testProjectSelect" class="select-input">
                            <option value="">Select a project</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Number of Questions</label>
                        <input type="number" id="testQuestionCount" class="text-input" value="10" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="testRandomOrder">
                            <span>Random order</span>
                        </label>
                    </div>
                    <button id="startTestBtn" class="btn btn-primary btn-large">
                        <i class="fas fa-play"></i>
                        Start Test
                    </button>
                </div>

                <div id="testActive" class="test-active hidden">
                    <div class="test-header">
                        <div class="test-progress">
                            Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span>
                        </div>
                        <div class="test-score">
                            Score: <span id="testScore">0</span>/<span id="testTotal">0</span>
                        </div>
                    </div>

                    <div class="test-card">
                        <div class="question-text" id="questionText"></div>
                        <div class="answers-list" id="answersList"></div>
                        <div class="feedback" id="answerFeedback"></div>
                        <div class="test-actions">
                            <button id="nextQuestionBtn" class="btn btn-primary hidden">Next Question</button>
                        </div>
                    </div>

                    <button id="endTestBtn" class="btn btn-danger">End Test</button>
                </div>

                <div id="testResults" class="test-results hidden">
                    <div class="results-card">
                        <div class="results-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h3>Test Complete!</h3>
                        <div class="results-score">
                            <div class="score-big" id="finalScore">0/0</div>
                            <div class="score-percentage" id="scorePercentage">0%</div>
                        </div>
                        <div class="results-actions">
                            <button id="retakeTestBtn" class="btn btn-primary">Retake Test</button>
                            <button id="backToDashboardBtn" class="btn btn-secondary">Back to Dashboard</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Study Materials Viewer Page -->
            <div id="studyMaterialsPage" class="page">
                <div class="page-header">
                    <h2 id="studyMaterialsTitle">Study Materials</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="studyListViewBtn" class="btn btn-secondary active">
                            <i class="fas fa-list"></i> List View
                        </button>
                        <button id="studyMindMapViewBtn" class="btn btn-secondary">
                            <i class="fas fa-project-diagram"></i> Mind Map
                        </button>
                        <button id="startStudyModeFromViewerBtn" class="btn btn-primary">
                            <i class="fas fa-graduation-cap"></i> Start Studying
                        </button>
                        <button id="closeStudyMaterialsBtn" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>

                <!-- List View -->
                <div id="studyListView" class="active">
                    <div id="studyCardsListViewer" style="display: flex; flex-direction: column; gap: 1rem;">
                        <!-- Study cards will be rendered here -->
                    </div>
                </div>

                <!-- Mind Map View -->
                <div id="studyMindMapView" class="hidden">
                    <div id="mindMapContainer" style="width: 100%; height: calc(100vh - 200px); background: var(--background); border: 1px solid var(--border); border-radius: var(--radius-lg); position: relative;">
                        <svg id="mindMapSvg" style="width: 100%; height: 100%;"></svg>
                        <div id="mindMapTooltip" style="position: absolute; padding: 1rem; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-md); box-shadow: var(--shadow-xl); pointer-events: none; opacity: 0; transition: opacity 0.2s; max-width: 400px; z-index: 1000;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary);"></h4>
                            <p style="margin: 0; color: var(--text-secondary);"></p>
                        </div>
                        <!-- Mastery Legend -->
                        <div style="position: absolute; bottom: 1rem; right: 1rem; padding: 1rem; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-md); box-shadow: var(--shadow-md);">
                            <h5 style="margin: 0 0 0.5rem 0; color: var(--text); font-size: 0.875rem; font-weight: 600;">Mastery Level</h5>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.75rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 20px; height: 20px; border-radius: 50%; background: var(--surface); border: 3px solid #10b981;"></div>
                                    <span style="color: var(--text);">Mastered</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 20px; height: 20px; border-radius: 50%; background: var(--surface); border: 3px solid #3b82f6;"></div>
                                    <span style="color: var(--text);">Good</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 20px; height: 20px; border-radius: 50%; background: var(--surface); border: 3px solid #f59e0b;"></div>
                                    <span style="color: var(--text);">Learning</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 20px; height: 20px; border-radius: 50%; background: var(--surface); border: 3px solid #ef4444;"></div>
                                    <span style="color: var(--text);">Needs Review</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 20px; height: 20px; border-radius: 50%; background: var(--surface); border: 2px solid #6b7280;"></div>
                                    <span style="color: var(--text-muted);">Not Studied</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fullscreen Note Editor -->
            <div id="fullscreenNoteEditor" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: var(--background); z-index: 1000;">
                <div style="display: flex; height: 100vh;">
                    <!-- Collapsible Sidebar -->
                    <div id="editorSidebar" style="width: 280px; background: var(--surface); border-right: 1px solid var(--border); display: flex; flex-direction: column; transition: transform 0.3s ease;">
                        <!-- Sidebar Header -->
                        <div style="padding: 1.5rem; border-bottom: 1px solid var(--border);">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                                <h3 style="margin: 0; font-size: 0.875rem; color: var(--text); font-weight: 600;">
                                    <i class="fas fa-file-alt" style="margin-right: 0.35rem"></i> <span id="sidebarProjectName">Notes</span>
                                </h3>
                                <button id="toggleSidebarBtn" class="btn btn-sm" style="padding: 0.375rem; background: transparent; border: none; color: var(--text-muted);" title="Toggle sidebar">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button id="addNoteFromSidebarBtn" class="btn btn-primary" style="flex: 1; justify-content: center; font-size: 0.875rem; padding: 0.5rem;">
                                    <i class="fas fa-plus"></i> New
                                </button>
                                <input type="file" id="importNotesFileSidebar" accept=".pdf,.docx,.txt,.md" style="display: none;">
                                <button id="importFileFromSidebarBtn" class="btn btn-secondary" style="flex: 1; justify-content: center; font-size: 0.875rem; padding: 0.5rem;">
                                    <i class="fas fa-file-import"></i> Import
                                </button>
                            </div>
                        </div>

                        <!-- Files List -->
                        <div id="sidebarNotesList" style="flex: 1; overflow-y: auto; padding: 0.5rem;">
                            <!-- Note files will be rendered here -->
                        </div>

                        <!-- Sidebar Footer - Sticky to bottom -->
                        <div style="padding: 1rem; border-top: 1px solid var(--border); margin-top: auto;">
                            <button id="closeEditorBtn" class="btn btn-secondary" style="width: 100%; justify-content: center;">
                                <i class="fas fa-arrow-left"></i> Back to Project
                            </button>
                        </div>
                    </div>

                    <!-- Main Editor Area -->
                    <div style="flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden;">
                        <!-- Top Bar -->
                        <div class="editor-top-bar" style="padding: 1rem 2rem; border-bottom: 1px solid var(--border); background: var(--surface); display: flex; align-items: center; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <button id="showSidebarBtn" class="btn btn-secondary" style="display: none; padding: 0.75rem 1rem; border-radius: 16px;">
                                    <i class="fas fa-bars"></i>
                                </button>
                                <button id="cleanCurrentNoteBtn" class="btn btn-secondary" title="Use AI to clean, format, and organize this note" style="border-radius: 16px; margin-right: 1rem;">
                                    <i class="fas fa-wand-magic-sparkles"></i>
                                    <span>AI Clean</span>
                                </button>
                            </div>
                            <div style="flex: 1; max-width: 800px; margin: 0 auto;">
                                <input type="text" id="fullscreenNoteTitle" placeholder="Untitled Note"
                                       style="width: 100%; background: transparent; border: none; padding: 1.2rem;
                                              margin-right: 1rem; font-size: 1.5rem; font-weight: 700; outline: none;">
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <span id="fullscreenNoteSaveStatus" style="font-size: 0.8rem; color: var(--text-muted); display: flex; align-items: center; gap: 0.4rem; margin-left: 1rem; padding: 0.375rem 0.75rem; background: rgba(29, 185, 84, 0.08); border-radius: 12px; transition: all 0.25s ease;">
                                    <i class="fas fa-circle" style="font-size: 0.4rem; color: var(--success); filter: drop-shadow(0 0 3px rgba(29, 185, 84, 0.6));"></i> <span style="font-weight: 500; letter-spacing: 0.02em;">Saved</span>
                                </span>
                            </div>
                        </div>

                        <!-- Editor Container -->
                        <div style="flex: 1; overflow-y: auto; background: var(--background);">
                            <!-- Mobile title (hidden on desktop) -->
                            <input type="text" id="mobileNoteTitle" placeholder="Untitled Note" style="display: none;">
                            <div style="max-width: 900px; margin: 0 auto; padding: 3rem 2rem;">
                                <div id="fullscreenNotesEditor" style="min-height: 500px; background: var(--surface);  padding: 2rem; box-shadow: var(--shadow-md);"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Page -->
            <div id="accountPage" class="page">
                <div class="account-section">
                    <h3>Profile</h3>
                    <div class="form-group">
                        <label>Display Name</label>
                        <input type="text" id="displayNameInput" class="text-input" placeholder="Your name">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="accountEmailInput" class="text-input" disabled>
                    </div>
                    <button id="updateProfileBtn" class="btn btn-primary">Update Profile</button>
                </div>

                <div class="account-section">
                    <h3>Membership Status</h3>
                    <div id="proStatus" class="pro-status-card">
                        <div class="pro-status-content">
                            <div class="pro-icon">
                                <i class="fas fa-crown"></i>
                            </div>
                            <div>
                                <h4 id="proStatusTitle">Free Plan</h4>
                                <p id="proStatusDesc">You are currently on the free plan. Contact support to upgrade to Pro for unlimited AI-generated cards!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="account-section">
                    <h3>Developer Access</h3>
                    <div id="devStatus" style="padding: 1rem; background: var(--surface-light); border: 2px solid var(--border); border-radius: var(--radius-md); margin-bottom: 1rem;">
                        <div class="hidden" id="isDevUser" style="display: flex; align-items: center; gap: 1rem;">
                            <i class="fas fa-tools" style="font-size: 2rem; color: var(--primary);"></i>
                            <div>
                                <h4 style="margin: 0; color: var(--primary);">Developer Account ⚙️</h4>
                                <p style="color: var(--text-secondary); margin: 0.5rem 0 0;">You have access to the Dev Dashboard to create public quizzes!</p>
                            </div>
                        </div>
                        <div id="notDevUser">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <i class="fas fa-info-circle" style="font-size: 2rem; color: var(--text-secondary);"></i>
                                <div>
                                    <h4 style="margin: 0;">Regular Account</h4>
                                    <p style="color: var(--text-secondary); margin: 0.5rem 0 0;">Developer access allows you to create public quizzes. Contact an administrator to request dev access.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="account-section">
                    <h3>AI API Keys <span style="color: var(--text-muted); font-size: 0.875rem; font-weight: normal;">(Free users only)</span></h3>
                    <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">
                        Add your AI API keys to enable automatic card generation. Your keys are stored locally and never shared.
                    </p>
                    <p id="proUserNote" class="hidden" style="color: var(--primary); font-size: 0.875rem; margin-bottom: 1rem; padding: 0.75rem; background: rgba(29, 185, 84, 0.1); border-radius: var(--radius-md);">
                        <i class="fas fa-crown"></i> You're a Pro user! Use the Auto Generate feature without entering API keys.
                    </p>

                    <div class="form-group">
                        <label>OpenAI API Key</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="password" id="openaiKeyInput" class="text-input" placeholder="sk-...">
                            <button id="saveOpenAIKey" class="btn btn-secondary">Save</button>
                            <button id="clearOpenAIKey" class="btn btn-danger" style="padding: 0.75rem 1rem;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Anthropic (Claude) API Key</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="password" id="claudeKeyInput" class="text-input" placeholder="sk-ant-...">
                            <button id="saveClaudeKey" class="btn btn-secondary">Save</button>
                            <button id="clearClaudeKey" class="btn btn-danger" style="padding: 0.75rem 1rem;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Google AI (Gemini) API Key</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="password" id="geminiKeyInput" class="text-input" placeholder="AIza...">
                            <button id="saveGeminiKey" class="btn btn-secondary">Save</button>
                            <button id="clearGeminiKey" class="btn btn-danger" style="padding: 0.75rem 1rem;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="account-section">
                    <h3>Security</h3>
                    <button id="changePasswordBtn" class="btn btn-secondary">Change Password</button>
                    <button id="managePasskeysBtn" class="btn btn-secondary">Manage Passkeys</button>
                </div>
                <div class="account-section danger-zone">
                    <h3>Danger Zone</h3>
                    <button id="deleteAccountBtn" class="btn btn-danger">Delete Account</button>
                </div>
            </div>

            <!-- Explore Page (Public Projects) -->
            <div id="explorePage" class="page">
                <div class="page-header">
                    <div class="filter-group">
                        <select id="exploreCategory" class="select-input">
                            <option value="all">All Categories</option>
                            <option value="coding">Coding</option>
                            <option value="science">Science</option>
                            <option value="math">Math</option>
                            <option value="history">History</option>
                            <option value="language">Language</option>
                            <option value="geography">Geography</option>
                            <option value="art">Art & Design</option>
                            <option value="business">Business</option>
                            <option value="technology">Technology</option>
                            <option value="health">Health & Fitness</option>
                            <option value="music">Music</option>
                            <option value="literature">Literature</option>
                            <option value="other">Other</option>
                        </select>
                        <select id="exploreDifficulty" class="select-input">
                            <option value="all">All Difficulties</option>
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                            <option value="mixed">Mixed</option>
                        </select>
                        <input type="text" id="exploreSearch" class="text-input" placeholder="Search quizzes...">
                    </div>
                </div>
                <div id="publicProjectsList" class="projects-grid">
                    <div class="empty-state">
                        <i class="fas fa-globe"></i>
                        <p>No public quizzes available yet. Check back soon!</p>
                    </div>
                </div>
            </div>

            <!-- Public Quiz Page -->
            <div id="publicQuizPage" class="page">
                <div class="page-header">
                    <h2 id="publicQuizPageTitle" style="margin: 0;">Quiz</h2>
                </div>
                <div id="publicQuizPageContent"></div>
            </div>

            <!-- Project Test Page -->
            <div id="projectTestPage" class="page">
                <div class="page-header">
                    <h2 id="projectTestPageTitle" style="margin: 0;">Test</h2>
                </div>
                <div id="projectTestPageContent"></div>
            </div>

            <!-- Dev Dashboard Page -->
            <div id="devPage" class="page">
                <div class="page-header">
                    <h2 style="margin: 0; flex: 1;">Developer Dashboard</h2>
                    <button id="createPublicProjectBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Create Public Project
                    </button>
                </div>

                <div class="section">
                    <h3>My Public Projects</h3>
                    <div id="devProjectsList" class="projects-grid">
                        <div class="empty-state">
                            <i class="fas fa-tools"></i>
                            <p>No public projects yet. Create your first public quiz!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Page -->
            <div id="leaderboardPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-trophy"></i> Global Leaderboards</h2>
                    <p>Top performers across all quizzes</p>
                </div>

                <div class="section" style="margin-top: 2rem;">
                    <h3><i class="fas fa-fire"></i> Top Users by Streak</h3>
                    <div id="topStreaksLeaderboard"></div>
                </div>
            </div>

            <!-- Admin Console Page -->
            <div id="adminPage" class="page">
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="users"><i class="fas fa-users"></i> Users</button>
                    <button class="admin-tab" data-tab="devs"><i class="fas fa-user-cog"></i> Developers</button>
                    <button class="admin-tab" data-tab="projects"><i class="fas fa-folder-open"></i> Public Projects</button>
                    <button class="admin-tab" data-tab="analytics"><i class="fas fa-chart-line"></i> Analytics</button>
                </div>

                <!-- Users Tab -->
                <div id="usersTab" class="admin-tab-content active">
                    <div class="page-header">
                        <input type="text" id="adminUserSearch" class="text-input" placeholder="Search by email or UID (leave empty to show all)..." style="flex: 1; max-width: 400px;">
                        <button id="searchUsersBtn" class="btn btn-primary"><i class="fas fa-search"></i> Search</button>
                    </div>
                    <div id="adminUsersList">
                        <div class="empty-state">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Loading users...</p>
                        </div>
                    </div>
                </div>

                <!-- Devs Tab -->
                <div id="devsTab" class="admin-tab-content">
                    <div id="adminDevsList"></div>
                </div>

                <!-- Projects Tab -->
                <div id="projectsAdminTab" class="admin-tab-content">
                    <div id="adminProjectsList"></div>
                </div>

                <!-- Analytics Tab -->
                <div id="analyticsTab" class="admin-tab-content">
                    <div class="dashboard-grid" id="adminStats">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-users"></i></div>
                            <div class="stat-content">
                                <div class="stat-value" id="totalUsers">0</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-crown"></i></div>
                            <div class="stat-content">
                                <div class="stat-value" id="totalProUsers">0</div>
                                <div class="stat-label">Pro Users</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-tools"></i></div>
                            <div class="stat-content">
                                <div class="stat-value" id="totalDevUsers">0</div>
                                <div class="stat-label">Dev Users</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-globe"></i></div>
                            <div class="stat-content">
                                <div class="stat-value" id="totalPublicProjects">0</div>
                                <div class="stat-label">Public Projects</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-fire"></i></div>
                            <div class="stat-content">
                                <div class="stat-value" id="avgStreak">0</div>
                                <div class="stat-label">Avg Daily Streak</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                            <div class="stat-content">
                                <div class="stat-value" id="totalQuizAttempts">0</div>
                                <div class="stat-label">Total Quiz Attempts</div>
                            </div>
                        </div>
                    </div>

                    <div class="section" style="margin-top: 2rem;">
                        <h3>Analytics Charts</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
                            <div style="background: var(--surface); padding: 1.5rem; border-radius: var(--radius-lg); border: 1px solid var(--border);">
                                <h4 style="margin-bottom: 1rem; color: var(--text-primary);">User Activity (Last 7 Days)</h4>
                                <canvas id="activityChart"></canvas>
                            </div>
                            <div style="background: var(--surface); padding: 1.5rem; border-radius: var(--radius-lg); border: 1px solid var(--border);">
                                <h4 style="margin-bottom: 1rem; color: var(--text-primary);">User Distribution</h4>
                                <canvas id="userTypeChart"></canvas>
                            </div>
                            <div style="background: var(--surface); padding: 1.5rem; border-radius: var(--radius-lg); border: 1px solid var(--border);">
                                <h4 style="margin-bottom: 1rem; color: var(--text-primary);">Top Public Projects</h4>
                                <canvas id="topProjectsChart"></canvas>
                            </div>
                            <div style="background: var(--surface); padding: 1.5rem; border-radius: var(--radius-lg); border: 1px solid var(--border);">
                                <h4 style="margin-bottom: 1rem; color: var(--text-primary);">Daily Streaks</h4>
                                <canvas id="streaksChart"></canvas>
                            </div>
                            <div style="background: var(--surface); padding: 1.5rem; border-radius: var(--radius-lg); border: 1px solid var(--border);">
                                <h4 style="margin-bottom: 1rem; color: var(--text-primary);">User Registrations (Last 30 Days)</h4>
                                <canvas id="registrationChart"></canvas>
                            </div>
                            <div style="background: var(--surface); padding: 1.5rem; border-radius: var(--radius-lg); border: 1px solid var(--border);">
                                <h4 style="margin-bottom: 1rem; color: var(--text-primary);">Project Categories</h4>
                                <canvas id="categoriesChart"></canvas>
                            </div>
                            <div style="background: var(--surface); padding: 1.5rem; border-radius: var(--radius-lg); border: 1px solid var(--border);">
                                <h4 style="margin-bottom: 1rem; color: var(--text-primary);">User Engagement</h4>
                                <canvas id="engagementChart"></canvas>
                            </div>
                            <div style="background: var(--surface); padding: 1.5rem; border-radius: var(--radius-lg); border: 1px solid var(--border);">
                                <h4 style="margin-bottom: 1rem; color: var(--text-primary);">Average Quiz Performance</h4>
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Create/Edit Project Modal -->
    <div id="projectModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="projectModalTitle">Create Project</h3>
                <button class="modal-close" data-modal="projectModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Project Name</label>
                    <input type="text" id="projectNameInput" class="text-input" placeholder="e.g., Biology 101">
                </div>
                <div class="form-group">
                    <label>Description (optional)</label>
                    <textarea id="projectDescInput" class="text-input" rows="3" placeholder="What's this project about?"></textarea>
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <div class="color-picker">
                        <input type="color" id="projectColorInput" value="#1db954">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="projectModal">Cancel</button>
                <button id="saveProjectBtn" class="btn btn-primary">
                    <span id="saveProjectBtnText">Save Project</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Create/Edit Card Modal -->
    <div id="cardModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="cardModalTitle">Create Card</h3>
                <button class="modal-close" data-modal="cardModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Project</label>
                    <select id="cardProjectSelect" class="select-input">
                        <option value="">Select a project</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Question</label>
                    <textarea id="cardQuestionInput" class="text-input" rows="3" placeholder="Enter your question"></textarea>
                </div>
                <div class="form-group">
                    <label>Answer Options</label>
                    <div class="answer-options">
                        <div class="answer-option">
                            <input type="radio" name="correctAnswer" value="0" id="correct0" checked>
                            <input type="text" id="option0" class="text-input" placeholder="Option A">
                            <label for="correct0" class="correct-label">Correct</label>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="correctAnswer" value="1" id="correct1">
                            <input type="text" id="option1" class="text-input" placeholder="Option B">
                            <label for="correct1" class="correct-label">Correct</label>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="correctAnswer" value="2" id="correct2">
                            <input type="text" id="option2" class="text-input" placeholder="Option C">
                            <label for="correct2" class="correct-label">Correct</label>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="correctAnswer" value="3" id="correct3">
                            <input type="text" id="option3" class="text-input" placeholder="Option D">
                            <label for="correct3" class="correct-label">Correct</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Explanation (optional)</label>
                    <textarea id="cardExplanationInput" class="text-input" rows="2" placeholder="Why is this the correct answer?"></textarea>
                </div>
                <div class="form-group">
                    <label>Difficulty</label>
                    <select id="cardDifficultySelect" class="select-input">
                        <option value="easy">Easy</option>
                        <option value="medium" selected>Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="cardModal">Cancel</button>
                <button id="saveCardBtn" class="btn btn-primary">Save Card</button>
            </div>
        </div>
    </div>

    <!-- AI Generation Modal -->
    <div id="aiModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Generate Cards with AI</h3>
                <button class="modal-close" data-modal="aiModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Generation Method Tabs -->
                <div class="ai-tabs">
                    <button class="ai-tab active" data-tab="auto">
                        <i class="fas fa-magic"></i>
                        Auto Generate
                    </button>
                    <button class="ai-tab" data-tab="manual">
                        <i class="fas fa-copy"></i>
                        Copy-Paste Method
                    </button>
                    <button class="ai-tab" data-tab="json">
                        <i class="fas fa-code"></i>
                        Paste JSON
                    </button>
                </div>

                <!-- Common Fields -->
                <div class="form-group">
                    <label>Select Project</label>
                    <select id="aiProjectSelect" class="select-input">
                        <option value="">Select a project</option>
                    </select>
                </div>

                <!-- Auto Generate Tab -->
                <div id="autoTab" class="ai-tab-content active">
                    <div id="proAINote" class="hidden" style="padding: 1rem; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%); border: 2px solid #ffd700; border-radius: var(--radius-md); margin-bottom: 1rem;">
                        <p style="color: var(--text-primary); margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-crown" style="color: #ffd700;"></i>
                            <strong>Pro Member:</strong> Select "Pro API" to generate unlimited cards using our premium service!
                        </p>
                    </div>
                    <div class="form-group">
                        <label>AI Provider</label>
                        <select id="aiProvider" class="select-input">
                            <option value="">Select AI Provider</option>
                            <option value="pro" id="proProviderOption" class="hidden">⭐ Pro API (Unlimited)</option>
                            <option value="openai">OpenAI (GPT-4)</option>
                            <option value="claude">Anthropic (Claude)</option>
                            <option value="gemini">Google (Gemini)</option>
                        </select>
                    </div>

                    <div id="proModelSelector" class="form-group hidden">
                        <label>Pro AI Model</label>
                        <select id="proModel" class="select-input">
                            <option value="gpt-4o">GPT-4o (Best Quality)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (Balanced)</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo (Fast & Quality)</option>
                            <option value="gpt-4">GPT-4 (High Quality)</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fastest)</option>
                            <option value="gpt-5-nano-2025-08-07" selected>GPT-5 Nano (Cost-Effective)</option>
                        </select>
                        <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem;">
                            Different models have different costs. GPT-5 Nano is recommended for unlimited usage.
                        </p>
                    </div>

                    <div class="form-group">
                        <label>Upload or Paste Study Material</label>
                        <div class="file-upload-area">
                            <input type="file" id="fileUpload" accept=".txt,.md,.doc,.docx,.pdf" class="hidden">
                            <button id="uploadFileBtn" class="btn btn-secondary">
                                <i class="fas fa-upload"></i>
                                Upload File
                            </button>
                            <span id="fileName" style="margin-left: 1rem; color: var(--text-secondary);"></span>
                        </div>
                        <textarea id="aiTextInput" class="text-input" rows="8" placeholder="Or paste text, notes, or study material here..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Number of cards to generate</label>
                        <input type="number" id="aiCardCount" class="text-input" value="5" min="1" max="50">
                    </div>

                    <div class="form-group">
                        <label>Target Difficulty</label>
                        <select id="aiDifficultySelect" class="select-input">
                            <option value="easy">Easy (with some medium)</option>
                            <option value="medium" selected>Medium (with some easy/hard)</option>
                            <option value="hard">Hard (with some medium)</option>
                            <option value="mixed">Mixed (all difficulties)</option>
                        </select>
                        <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.25rem;">AI will generate cards around this difficulty level with natural variation</p>
                    </div>

                    <div id="aiGenerating" class="ai-generating hidden">
                        <div class="spinner"></div>
                        <p>Generating cards...</p>
                    </div>

                    <div id="aiError" class="hidden" style="padding: 1rem; background: rgba(255, 92, 92, 0.1); border: 1px solid var(--danger); border-radius: var(--radius-md); margin-top: 1rem;">
                        <p style="color: var(--danger); margin: 0;"></p>
                    </div>
                </div>

                <!-- Manual Copy-Paste Tab -->
                <div id="manualTab" class="ai-tab-content">
                    <div class="form-group">
                        <label>Upload or Paste Study Material</label>
                        <div class="file-upload-area">
                            <input type="file" id="manualFileUpload" accept=".txt,.md,.doc,.docx,.pdf" class="hidden">
                            <button id="manualUploadFileBtn" class="btn btn-secondary">
                                <i class="fas fa-upload"></i>
                                Upload File
                            </button>
                            <span id="manualFileName" style="margin-left: 1rem; color: var(--text-secondary);"></span>
                        </div>
                        <textarea id="manualTextInput" class="text-input" rows="8" placeholder="Or paste your study material here..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Number of cards to generate</label>
                        <input type="number" id="manualCardCount" class="text-input" value="5" min="1" max="50">
                    </div>

                    <div class="form-group">
                        <label>Target Difficulty</label>
                        <select id="manualDifficultySelect" class="select-input">
                            <option value="easy">Easy (with some medium)</option>
                            <option value="medium" selected>Medium (with some easy/hard)</option>
                            <option value="hard">Hard (with some medium)</option>
                            <option value="mixed">Mixed (all difficulties)</option>
                        </select>
                    </div>

                    <button id="generatePromptBtn" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                        <i class="fas fa-magic"></i>
                        Generate Prompt
                    </button>

                    <div id="generatedPrompt" class="hidden">
                        <div class="form-group">
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Copy this prompt to your AI</span>
                                <button id="copyPromptBtn" class="btn btn-secondary" style="padding: 0.5rem 1rem;">
                                    <i class="fas fa-copy"></i>
                                    Copy Prompt
                                </button>
                            </label>
                            <textarea id="promptText" class="text-input" rows="6" readonly></textarea>
                        </div>

                        <div class="form-group">
                            <label>Paste AI Response (JSON)</label>
                            <textarea id="aiResponse" class="text-input" rows="8" placeholder='Paste the JSON response from AI here...'></textarea>
                        </div>

                        <button id="importCardsBtn" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-download"></i>
                            Import Cards
                        </button>
                    </div>
                </div>

                <!-- JSON Import Tab -->
                <div id="jsonTab" class="ai-tab-content">
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Already have cards in JSON format? Paste them below to import directly.
                    </p>
                    <div class="form-group">
                        <label>Paste JSON Array</label>
                        <textarea id="jsonInput" class="text-input" rows="12" placeholder='[{"question": "...", "options": ["A", "B", "C", "D"], "correctAnswer": 0, "explanation": "..."}]'></textarea>
                    </div>
                    <button id="importJsonBtn" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-file-import"></i>
                        Import Cards from JSON
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="aiModal">Cancel</button>
                <button id="generateBtn" class="btn btn-primary ai-auto-only">
                    <i class="fas fa-magic"></i>
                    Generate Cards
                </button>
            </div>
        </div>
    </div>

    <!-- Create/Edit Public Project Modal -->
    <div id="publicProjectModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 id="publicProjectModalTitle">Create Public Project</h3>
                <button class="modal-close" data-modal="publicProjectModal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Project Name</label>
                    <input type="text" id="publicProjectName" class="text-input" placeholder="e.g., Biology 101">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="publicProjectDesc" class="text-input" rows="3" placeholder="Describe your quiz..."></textarea>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="publicProjectCategory" class="select-input">
                        <option value="coding">Coding</option>
                        <option value="science">Science</option>
                        <option value="math">Math</option>
                        <option value="history">History</option>
                        <option value="language">Language</option>
                        <option value="geography">Geography</option>
                        <option value="art">Art & Design</option>
                        <option value="business">Business</option>
                        <option value="technology">Technology</option>
                        <option value="health">Health & Fitness</option>
                        <option value="music">Music</option>
                        <option value="literature">Literature</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Difficulty</label>
                    <select id="publicProjectDifficulty" class="select-input">
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                        <option value="mixed">Mixed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tags (comma-separated)</label>
                    <input type="text" id="publicProjectTags" class="text-input" placeholder="biology, cells, dna">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="publicProjectModal">Cancel</button>
                <button id="savePublicProjectBtn" class="btn btn-primary">Save Project</button>
            </div>
        </div>
    </div>

    <!-- Public Quiz Test Modal -->
    <div id="publicQuizModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="publicQuizTitle">Quiz</h3>
                <button class="modal-close" onclick="window.closePublicQuiz()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="publicQuizContent"></div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboardModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fas fa-trophy"></i> Leaderboard</h3>
                <button class="modal-close" data-modal="leaderboardModal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="leaderboardContent"></div>
            </div>
        </div>
    </div>

    <!-- Manage Public Project Cards Modal -->
    <div id="publicCardsModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="publicCardsModalTitle">Manage Cards</h3>
                <button class="modal-close" data-modal="publicCardsModal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button id="addPublicCardBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Card
                    </button>
                    <button id="generatePublicCardsBtn" class="btn btn-secondary">
                        <i class="fas fa-magic"></i> Generate with AI
                    </button>
                </div>
                <div id="publicCardsList"></div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Public Card Modal -->
    <div id="editPublicCardModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 id="editPublicCardTitle">Add Card</h3>
                <button class="modal-close" data-modal="editPublicCardModal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Question</label>
                    <textarea id="publicCardQuestion" class="text-input" rows="3" placeholder="Enter your question..."></textarea>
                </div>
                <div class="form-group">
                    <label>Options</label>
                    <div class="answer-options">
                        <div class="answer-option">
                            <input type="radio" name="publicCorrectAnswer" value="0" checked>
                            <input type="text" id="publicOption0" class="text-input" placeholder="Option A">
                            <span class="correct-label">Correct</span>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="publicCorrectAnswer" value="1">
                            <input type="text" id="publicOption1" class="text-input" placeholder="Option B">
                            <span class="correct-label">Correct</span>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="publicCorrectAnswer" value="2">
                            <input type="text" id="publicOption2" class="text-input" placeholder="Option C">
                            <span class="correct-label">Correct</span>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="publicCorrectAnswer" value="3">
                            <input type="text" id="publicOption3" class="text-input" placeholder="Option D">
                            <span class="correct-label">Correct</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Explanation (Optional)</label>
                    <textarea id="publicCardExplanation" class="text-input" rows="2" placeholder="Explain why this is the correct answer..."></textarea>
                </div>
                <div class="form-group">
                    <label>Difficulty</label>
                    <select id="publicCardDifficulty" class="select-input">
                        <option value="easy">Easy</option>
                        <option value="medium" selected>Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="editPublicCardModal">Cancel</button>
                <button id="savePublicCardBtn" class="btn btn-primary">Save Card</button>
            </div>
        </div>
    </div>

    <!-- Generate Study Materials Modal -->
    <div id="studyMaterialsModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fas fa-brain"></i> Generate Study Materials</h3>
                <button class="modal-close" data-modal="studyMaterialsModal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Study Material Content</label>
                    <textarea id="studyMaterialInput" class="text-input" rows="10" placeholder="Paste your study content here (notes, textbook chapters, lecture transcripts, etc.)..."></textarea>
                </div>

                <div class="form-group">
                    <label>AI Model</label>
                    <select id="studyMaterialModel" class="select-input">
                        <option value="gpt-4o">GPT-4o (Best Quality)</option>
                        <option value="gpt-4o-mini">GPT-4o Mini (Balanced)</option>
                        <option value="gpt-5-nano-2025-08-07" selected>GPT-5 Nano (Cost-Effective)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Quiz Cards to Generate</label>
                    <input type="number" id="quizCardCount" class="text-input" value="30" min="10" max="50">
                    <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.25rem;">Study cards will be generated automatically based on content length</p>
                </div>

                <div id="studyMaterialGenerating" class="ai-generating hidden">
                    <div class="spinner"></div>
                    <p id="studyMaterialStatus">Generating study materials...</p>
                </div>

                <div id="studyMaterialError" class="hidden" style="padding: 1rem; background: rgba(255, 92, 92, 0.1); border: 1px solid var(--danger); border-radius: var(--radius-md); margin-top: 1rem;">
                    <p style="color: var(--danger); margin: 0;"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="studyMaterialsModal">Cancel</button>
                <button id="generateStudyMaterialsBtn" class="btn btn-primary">
                    <i class="fas fa-magic"></i> Generate All
                </button>
            </div>
        </div>
    </div>

    <!-- Add Test Card Modal -->
    <div id="addTestCardModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-layer-group"></i> Add Test Card</h3>
                <button class="modal-close" data-modal="addTestCardModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Question</label>
                    <textarea id="testCardQuestion" class="text-input" rows="3" placeholder="Enter your question..." required></textarea>
                </div>

                <div class="form-group">
                    <label>Answer Options</label>
                    <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: var(--spacing-sm);">
                        <i class="fas fa-info-circle"></i> Select the correct answer by clicking the radio button
                    </p>
                    <div class="answer-options">
                        <div class="answer-option">
                            <input type="radio" name="testCardCorrect" value="0" checked>
                            <input type="text" id="testCardOption0" class="text-input" placeholder="Option A" required>
                            <span class="correct-label">Correct</span>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="testCardCorrect" value="1">
                            <input type="text" id="testCardOption1" class="text-input" placeholder="Option B" required>
                            <span class="correct-label">Correct</span>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="testCardCorrect" value="2">
                            <input type="text" id="testCardOption2" class="text-input" placeholder="Option C" required>
                            <span class="correct-label">Correct</span>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="testCardCorrect" value="3">
                            <input type="text" id="testCardOption3" class="text-input" placeholder="Option D" required>
                            <span class="correct-label">Correct</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Explanation (Optional)</label>
                    <textarea id="testCardExplanation" class="text-input" rows="2" placeholder="Explain why this answer is correct..."></textarea>
                </div>

                <div class="form-group">
                    <label>Difficulty</label>
                    <select id="testCardDifficulty" class="select-input">
                        <option value="easy">Easy</option>
                        <option value="medium" selected>Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="addTestCardModal">Cancel</button>
                <button id="saveTestCardBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Test Card
                </button>
            </div>
        </div>
    </div>

    <!-- Add Study Card Modal -->
    <div id="addStudyCardModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-brain"></i> Add Study Card</h3>
                <button class="modal-close" data-modal="addStudyCardModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="studyCardTitle" class="text-input" placeholder="Card title..." required>
                </div>

                <div class="form-group">
                    <label>Content / Description</label>
                    <textarea id="newStudyCardContent" class="text-input" rows="4" placeholder="Card content..." required></textarea>
                </div>

                <div class="form-group">
                    <label>Parent Card</label>
                    <select id="studyCardParent" class="select-input">
                        <option value="">No Parent (Root Level)</option>
                    </select>
                    <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: var(--spacing-xs);">
                        <i class="fas fa-info-circle"></i> Select a parent to connect this card in the mind map hierarchy
                    </p>
                </div>

                <div class="form-group">
                    <label>Category</label>
                    <select id="studyCardCategory" class="select-input">
                        <option value="primary">Primary</option>
                        <option value="secondary">Secondary</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Color</label>
                    <div class="color-picker-grid" style="display: grid; grid-template-columns: repeat(8, 1fr); gap: var(--spacing-sm);">
                        <div class="color-picker-option selected" style="background: #667eea;" data-color="#667eea"></div>
                        <div class="color-picker-option" style="background: #764ba2;" data-color="#764ba2"></div>
                        <div class="color-picker-option" style="background: #f093fb;" data-color="#f093fb"></div>
                        <div class="color-picker-option" style="background: #f5576c;" data-color="#f5576c"></div>
                        <div class="color-picker-option" style="background: #4facfe;" data-color="#4facfe"></div>
                        <div class="color-picker-option" style="background: #00f2fe;" data-color="#00f2fe"></div>
                        <div class="color-picker-option" style="background: #43e97b;" data-color="#43e97b"></div>
                        <div class="color-picker-option" style="background: #38f9d7;" data-color="#38f9d7"></div>
                        <div class="color-picker-option" style="background: #fa709a;" data-color="#fa709a"></div>
                        <div class="color-picker-option" style="background: #fee140;" data-color="#fee140"></div>
                        <div class="color-picker-option" style="background: #30cfd0;" data-color="#30cfd0"></div>
                        <div class="color-picker-option" style="background: #330867;" data-color="#330867"></div>
                        <div class="color-picker-option" style="background: #ff6b6b;" data-color="#ff6b6b"></div>
                        <div class="color-picker-option" style="background: #ee5a6f;" data-color="#ee5a6f"></div>
                        <div class="color-picker-option" style="background: #ffd93d;" data-color="#ffd93d"></div>
                        <div class="color-picker-option" style="background: #6bcf7f;" data-color="#6bcf7f"></div>
                    </div>
                    <input type="hidden" id="studyCardColor" value="#667eea">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="addStudyCardModal">Cancel</button>
                <button id="saveStudyCardBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Study Card
                </button>
            </div>
        </div>
    </div>

    <!-- Note File Title Modal -->
    <div id="noteFileTitleModal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeNoteFileTitleModal()"></div>
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3>New Note File</h3>
                <button class="modal-close" onclick="closeNoteFileTitleModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="noteFileTitle">Note File Title</label>
                    <input
                        type="text"
                        id="noteFileTitle"
                        class="form-control"
                        placeholder="Untitled Note"
                        autocomplete="off"
                    >
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeNoteFileTitleModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmNoteFileTitle()">Create</button>
            </div>
        </div>
    </div>

    <!-- Generation Progress Modal -->
    <div id="generationProgressModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-magic"></i> Generating Cards</h3>
            </div>
            <div class="modal-body">
                <!-- Progress Bar -->
                <div style="margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span id="generationProgressStatus" style="font-weight: 500; color: var(--text);">Initializing...</span>
                        <span id="generationProgressPercent" style="font-weight: 600; color: var(--primary);">0%</span>
                    </div>
                    <div style="height: 8px; background: var(--surface-light); border-radius: 4px; overflow: hidden;">
                        <div id="generationProgressBar" style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); width: 0%; transition: width 0.3s ease;"></div>
                    </div>
                </div>

                <!-- Status Log -->
                <div id="generationStatusLog" style="max-height: 300px; overflow-y: auto; padding: 1rem; background: var(--surface-light); border-radius: var(--radius-md); font-family: 'Courier New', monospace; font-size: 0.875rem; color: var(--text-secondary);">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-spinner fa-spin" style="color: var(--primary);"></i>
                        <span>Starting generation...</span>
                    </div>
                </div>

                <!-- Cache Notice -->
                <div id="cacheNotice" class="hidden" style="margin-top: 1rem; padding: 0.75rem; background: rgba(29, 185, 84, 0.1); border: 1px solid var(--success); border-radius: var(--radius-md); display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-bolt" style="color: var(--success);"></i>
                    <span style="color: var(--success); font-size: 0.875rem;">Loaded from cache! Lightning fast ⚡</span>
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeProgressModal" class="btn btn-secondary hidden">Close</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal hidden">
        <div class="modal-backdrop" onclick="window.cancelConfirm()"></div>
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3 id="confirmModalTitle"><i class="fas fa-exclamation-triangle"></i> Confirm Action</h3>
                <button class="modal-close" onclick="window.cancelConfirm(); event.stopPropagation();">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirmModalMessage" style="color: var(--text-secondary); line-height: 1.6;"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.cancelConfirm(); event.stopPropagation();">Cancel</button>
                <button id="confirmModalButton" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Regenerate Project Modal -->
    <div id="regenerateModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-sync-alt"></i> Regenerate Project</h3>
                <button class="modal-close" data-modal="regenerateModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label><i class="fas fa-language" style="margin-right: 0.5rem;"></i>Generation Language</label>
                    <select id="regenerateLanguage" class="select-input">
                        <option value="en">English</option>
                        <option value="sk">Slovak</option>
                        <option value="cs">Czech</option>
                        <option value="de">German</option>
                        <option value="fr">French</option>
                        <option value="es">Spanish</option>
                        <option value="it">Italian</option>
                        <option value="pl">Polish</option>
                        <option value="ru">Russian</option>
                    </select>
                </div>

                <div style="margin: 1.5rem 0; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                    <label style="display: block; margin-bottom: 1rem; color: var(--text); font-weight: 600; font-size: 0.875rem;">
                        <i class="fas fa-tasks" style="margin-right: 0.5rem;"></i>What to Regenerate
                    </label>

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <label class="regenerate-checkbox-card" style="display: flex; align-items: center; cursor: pointer; padding: 1rem; border-radius: var(--radius-md); background: var(--surface); border: 2px solid var(--border); transition: all 0.2s;">
                            <input type="checkbox" id="regenerateStudyCards" checked class="custom-checkbox">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-left: 2rem;">
                                <i class="fas fa-graduation-cap" style="color: var(--primary);"></i>
                                <span style="font-weight: 600; color: var(--text); font-size: 0.9375rem;">Study Cards</span>
                            </div>
                        </label>

                        <div id="studyCardsCountGroup" style="margin-top: 0.125rem; margin-bottom: 1rem;">
                            <label style="display: block; font-size: 0.875rem; color: var(--text); margin-bottom: 0.5rem; font-weight: 500;">Number of study cards</label>
                            <input type="number" id="studyCardsCount" class="text-input" value="10" min="1" max="100" style="width: 100%;">
                        </div>

                        <label class="regenerate-checkbox-card" style="display: flex; align-items: center; cursor: pointer; padding: 1rem; border-radius: var(--radius-md); background: var(--surface); border: 2px solid var(--border); transition: all 0.2s;">
                            <input type="checkbox" id="regenerateTestCards" checked class="custom-checkbox">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-left: 2rem;">
                                <i class="fas fa-clipboard-check" style="color: var(--info);"></i>
                                <span style="font-weight: 600; color: var(--text); font-size: 0.9375rem;">Test Cards</span>
                            </div>
                        </label>

                        <div id="testCardsCountGroup" style="margin-top: 0.125rem;">
                            <label style="display: block; font-size: 0.875rem; color: var(--text); margin-bottom: 0.5rem; font-weight: 500;">Number of test cards</label>
                            <input type="number" id="testCardsCount" class="text-input" value="10" min="1" max="100" style="width: 100%;">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="regenerateModal">Cancel</button>
                <button id="confirmRegenerateBtn" class="btn btn-primary">
                    <i class="fas fa-sync-alt"></i> Regenerate
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Note Title Modal (Mobile) -->
    <div id="editNoteTitleModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 style="margin: 0; font-size: 1.25rem;">Edit Note Title</h2>
                <button class="btn-icon" data-modal="editNoteTitleModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="mobileNoteTitleInput">Note Title</label>
                    <input type="text" id="mobileNoteTitleInput" class="text-input" placeholder="Untitled Note">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="editNoteTitleModal">Cancel</button>
                <button id="saveMobileNoteTitleBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save
                </button>
            </div>
        </div>
    </div>

    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- D3.js for Mind Map -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Firebase SDKs -->
    <script type="module" src="js/firebase-init.js"></script>
    <script src="js/generation-optimizer.js"></script>
    <script type="module" src="js/project-detail.js"></script>
    <script type="module" src="js/app.js"></script>
    <script type="module" src="js/study-materials.js"></script>
</body>
</html>
