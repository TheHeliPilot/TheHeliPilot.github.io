<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Quiz Generator</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Authentication Page -->
    <div id="authPage" class="auth-page">
        <div class="auth-container">
            <div class="auth-box">
                <div class="auth-logo">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <h1>AI Quiz Generator</h1>
                <p class="auth-subtitle">Sign in to start learning</p>

                <!-- Passkey Login -->
                <button id="passkeyLoginBtn" class="btn btn-passkey">
                    <i class="fas fa-fingerprint"></i>
                    <span>Sign in with Passkey</span>
                </button>

                <div class="divider">
                    <span>or continue with email</span>
                </div>

                <!-- Email/Password Form -->
                <form id="authForm" class="auth-form">
                    <div class="form-group">
                        <label for="emailInput">Email</label>
                        <input type="email" id="emailInput" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="passwordInput">Password</label>
                        <input type="password" id="passwordInput" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" id="loginBtn">Sign In</button>
                </form>

                <button id="toggleRegisterBtn" class="btn btn-text">
                    Don't have an account? <strong>Create one</strong>
                </button>

                <button id="setupPasskeyBtn" class="btn btn-text hidden">
                    <i class="fas fa-shield-alt"></i> Set up Passkey for faster login
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app hidden">
        <!-- Navigation Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Quiz Gen</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-link" data-page="projects">
                    <i class="fas fa-folder"></i>
                    <span>Projects</span>
                </a>
                <a href="#" class="nav-link" data-page="cards">
                    <i class="fas fa-layer-group"></i>
                    <span>Cards</span>
                </a>
                <a href="#" class="nav-link" data-page="test">
                    <i class="fas fa-pencil-alt"></i>
                    <span>Test</span>
                </a>
                <a href="#" class="nav-link" data-page="account">
                    <i class="fas fa-user-circle"></i>
                    <span>Account</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <button id="logoutBtn" class="btn btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Mobile Sidebar Backdrop -->
        <div id="sidebarBackdrop" class="sidebar-backdrop"></div>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <button id="menuToggle" class="menu-toggle" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 id="pageTitle">Dashboard</h2>
                <div class="top-bar-actions">
                    <button id="darkModeToggle" class="icon-btn" title="Toggle Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="user-menu">
                        <button class="user-avatar" id="userMenuBtn">
                            <i class="fas fa-user-circle"></i>
                            <span id="userDisplayName">User</span>
                            <span id="proBadge" class="pro-badge hidden">
                                <i class="fas fa-crown"></i>
                                PRO
                            </span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page active">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalProjects">0</div>
                            <div class="stat-label">Projects</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalCards">0</div>
                            <div class="stat-label">Total Cards</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="masteredCards">0</div>
                            <div class="stat-label">Mastered</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="studyStreak">0</div>
                            <div class="stat-label">Day Streak</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Recent Projects</h3>
                    <div id="recentProjects" class="projects-list">
                        <div class="empty-state">
                            <i class="fas fa-folder-open"></i>
                            <p>No projects yet. Create your first project to get started!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects Page -->
            <div id="projectsPage" class="page">
                <div class="page-header">
                    <button id="createProjectBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        New Project
                    </button>
                </div>
                <div id="projectsList" class="projects-grid">
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>No projects yet. Create one to organize your cards!</p>
                    </div>
                </div>
            </div>

            <!-- Cards Page -->
            <div id="cardsPage" class="page">
                <div class="page-header">
                    <div class="filter-group">
                        <select id="projectFilter" class="select-input">
                            <option value="all">All Projects</option>
                        </select>
                    </div>
                    <div class="actions-group">
                        <button id="createCardBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            New Card
                        </button>
                        <button id="generateCardsBtn" class="btn btn-secondary">
                            <i class="fas fa-robot"></i>
                            Generate with AI
                        </button>
                    </div>
                </div>
                <div id="cardsList" class="cards-grid">
                    <div class="empty-state">
                        <i class="fas fa-layer-group"></i>
                        <p>No cards yet. Create or generate cards to start learning!</p>
                    </div>
                </div>
            </div>

            <!-- Test Page -->
            <div id="testPage" class="page">
                <div id="testSetup" class="test-setup">
                    <h3>Start a Test</h3>
                    <div class="form-group">
                        <label>Select Project</label>
                        <select id="testProjectSelect" class="select-input">
                            <option value="">Select a project</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Number of Questions</label>
                        <input type="number" id="testQuestionCount" class="text-input" value="10" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="testRandomOrder">
                            <span>Random order</span>
                        </label>
                    </div>
                    <button id="startTestBtn" class="btn btn-primary btn-large">
                        <i class="fas fa-play"></i>
                        Start Test
                    </button>
                </div>

                <div id="testActive" class="test-active hidden">
                    <div class="test-header">
                        <div class="test-progress">
                            Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span>
                        </div>
                        <div class="test-score">
                            Score: <span id="testScore">0</span>/<span id="testTotal">0</span>
                        </div>
                    </div>

                    <div class="test-card">
                        <div class="question-text" id="questionText"></div>
                        <div class="answers-list" id="answersList"></div>
                        <div class="feedback" id="answerFeedback"></div>
                        <div class="test-actions">
                            <button id="nextQuestionBtn" class="btn btn-primary hidden">Next Question</button>
                        </div>
                    </div>

                    <button id="endTestBtn" class="btn btn-danger">End Test</button>
                </div>

                <div id="testResults" class="test-results hidden">
                    <div class="results-card">
                        <div class="results-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h3>Test Complete!</h3>
                        <div class="results-score">
                            <div class="score-big" id="finalScore">0/0</div>
                            <div class="score-percentage" id="scorePercentage">0%</div>
                        </div>
                        <div class="results-actions">
                            <button id="retakeTestBtn" class="btn btn-primary">Retake Test</button>
                            <button id="backToDashboardBtn" class="btn btn-secondary">Back to Dashboard</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Page -->
            <div id="accountPage" class="page">
                <div class="account-section">
                    <h3>Profile</h3>
                    <div class="form-group">
                        <label>Display Name</label>
                        <input type="text" id="displayNameInput" class="text-input" placeholder="Your name">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="accountEmailInput" class="text-input" disabled>
                    </div>
                    <button id="updateProfileBtn" class="btn btn-primary">Update Profile</button>
                </div>

                <div class="account-section">
                    <h3>Membership Status</h3>
                    <div id="proStatus" class="pro-status-card">
                        <div class="pro-status-content">
                            <div class="pro-icon">
                                <i class="fas fa-crown"></i>
                            </div>
                            <div>
                                <h4 id="proStatusTitle">Free Plan</h4>
                                <p id="proStatusDesc">You are currently on the free plan. Contact support to upgrade to Pro for unlimited AI-generated cards!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="account-section">
                    <h3>AI API Keys <span style="color: var(--text-muted); font-size: 0.875rem; font-weight: normal;">(Free users only)</span></h3>
                    <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">
                        Add your AI API keys to enable automatic card generation. Your keys are stored locally and never shared.
                    </p>
                    <p id="proUserNote" class="hidden" style="color: var(--primary); font-size: 0.875rem; margin-bottom: 1rem; padding: 0.75rem; background: rgba(29, 185, 84, 0.1); border-radius: var(--radius-md);">
                        <i class="fas fa-crown"></i> You're a Pro user! Use the Auto Generate feature without entering API keys.
                    </p>

                    <div class="form-group">
                        <label>OpenAI API Key</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="password" id="openaiKeyInput" class="text-input" placeholder="sk-...">
                            <button id="saveOpenAIKey" class="btn btn-secondary">Save</button>
                            <button id="clearOpenAIKey" class="btn btn-danger" style="padding: 0.75rem 1rem;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Anthropic (Claude) API Key</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="password" id="claudeKeyInput" class="text-input" placeholder="sk-ant-...">
                            <button id="saveClaudeKey" class="btn btn-secondary">Save</button>
                            <button id="clearClaudeKey" class="btn btn-danger" style="padding: 0.75rem 1rem;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Google AI (Gemini) API Key</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="password" id="geminiKeyInput" class="text-input" placeholder="AIza...">
                            <button id="saveGeminiKey" class="btn btn-secondary">Save</button>
                            <button id="clearGeminiKey" class="btn btn-danger" style="padding: 0.75rem 1rem;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="account-section">
                    <h3>Security</h3>
                    <button id="changePasswordBtn" class="btn btn-secondary">Change Password</button>
                    <button id="managePasskeysBtn" class="btn btn-secondary">Manage Passkeys</button>
                </div>

                <div class="account-section">
                    <h3>Preferences</h3>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="darkModePreference">
                            <span>Dark mode</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="emailNotifications">
                            <span>Email notifications</span>
                        </label>
                    </div>
                </div>

                <div class="account-section danger-zone">
                    <h3>Danger Zone</h3>
                    <button id="deleteAccountBtn" class="btn btn-danger">Delete Account</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Create/Edit Project Modal -->
    <div id="projectModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="projectModalTitle">Create Project</h3>
                <button class="modal-close" data-modal="projectModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Project Name</label>
                    <input type="text" id="projectNameInput" class="text-input" placeholder="e.g., Biology 101">
                </div>
                <div class="form-group">
                    <label>Description (optional)</label>
                    <textarea id="projectDescInput" class="text-input" rows="3" placeholder="What's this project about?"></textarea>
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <div class="color-picker">
                        <input type="color" id="projectColorInput" value="#1db954">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="projectModal">Cancel</button>
                <button id="saveProjectBtn" class="btn btn-primary">Save Project</button>
            </div>
        </div>
    </div>

    <!-- Create/Edit Card Modal -->
    <div id="cardModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="cardModalTitle">Create Card</h3>
                <button class="modal-close" data-modal="cardModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Project</label>
                    <select id="cardProjectSelect" class="select-input">
                        <option value="">Select a project</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Question</label>
                    <textarea id="cardQuestionInput" class="text-input" rows="3" placeholder="Enter your question"></textarea>
                </div>
                <div class="form-group">
                    <label>Answer Options</label>
                    <div class="answer-options">
                        <div class="answer-option">
                            <input type="radio" name="correctAnswer" value="0" id="correct0" checked>
                            <input type="text" id="option0" class="text-input" placeholder="Option A">
                            <label for="correct0" class="correct-label">Correct</label>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="correctAnswer" value="1" id="correct1">
                            <input type="text" id="option1" class="text-input" placeholder="Option B">
                            <label for="correct1" class="correct-label">Correct</label>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="correctAnswer" value="2" id="correct2">
                            <input type="text" id="option2" class="text-input" placeholder="Option C">
                            <label for="correct2" class="correct-label">Correct</label>
                        </div>
                        <div class="answer-option">
                            <input type="radio" name="correctAnswer" value="3" id="correct3">
                            <input type="text" id="option3" class="text-input" placeholder="Option D">
                            <label for="correct3" class="correct-label">Correct</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Explanation (optional)</label>
                    <textarea id="cardExplanationInput" class="text-input" rows="2" placeholder="Why is this the correct answer?"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="cardModal">Cancel</button>
                <button id="saveCardBtn" class="btn btn-primary">Save Card</button>
            </div>
        </div>
    </div>

    <!-- AI Generation Modal -->
    <div id="aiModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Generate Cards with AI</h3>
                <button class="modal-close" data-modal="aiModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Generation Method Tabs -->
                <div class="ai-tabs">
                    <button class="ai-tab active" data-tab="auto">
                        <i class="fas fa-magic"></i>
                        Auto Generate
                    </button>
                    <button class="ai-tab" data-tab="manual">
                        <i class="fas fa-copy"></i>
                        Copy-Paste Method
                    </button>
                </div>

                <!-- Common Fields -->
                <div class="form-group">
                    <label>Select Project</label>
                    <select id="aiProjectSelect" class="select-input">
                        <option value="">Select a project</option>
                    </select>
                </div>

                <!-- Auto Generate Tab -->
                <div id="autoTab" class="ai-tab-content active">
                    <div id="proAINote" class="hidden" style="padding: 1rem; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%); border: 2px solid #ffd700; border-radius: var(--radius-md); margin-bottom: 1rem;">
                        <p style="color: var(--text-primary); margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-crown" style="color: #ffd700;"></i>
                            <strong>Pro Member:</strong> Select "Pro API" to generate unlimited cards using our premium service!
                        </p>
                    </div>
                    <div class="form-group">
                        <label>AI Provider</label>
                        <select id="aiProvider" class="select-input">
                            <option value="">Select AI Provider</option>
                            <option value="pro" id="proProviderOption" class="hidden">⭐ Pro API (Unlimited)</option>
                            <option value="openai">OpenAI (GPT-4)</option>
                            <option value="claude">Anthropic (Claude)</option>
                            <option value="gemini">Google (Gemini)</option>
                        </select>
                    </div>

                    <div id="proModelSelector" class="form-group hidden">
                        <label>Pro AI Model</label>
                        <select id="proModel" class="select-input">
                            <option value="gpt-4o">GPT-4o (Best Quality)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (Balanced)</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo (Fast & Quality)</option>
                            <option value="gpt-4">GPT-4 (High Quality)</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fastest)</option>
                            <option value="gpt-5-nano-2025-08-07" selected>GPT-5 Nano (Cost-Effective)</option>
                        </select>
                        <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem;">
                            Different models have different costs. GPT-5 Nano is recommended for unlimited usage.
                        </p>
                    </div>

                    <div class="form-group">
                        <label>Upload or Paste Study Material</label>
                        <div class="file-upload-area">
                            <input type="file" id="fileUpload" accept=".txt,.md,.doc,.docx,.pdf" class="hidden">
                            <button id="uploadFileBtn" class="btn btn-secondary">
                                <i class="fas fa-upload"></i>
                                Upload File
                            </button>
                            <span id="fileName" style="margin-left: 1rem; color: var(--text-secondary);"></span>
                        </div>
                        <textarea id="aiTextInput" class="text-input" rows="8" placeholder="Or paste text, notes, or study material here..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Number of cards to generate</label>
                        <input type="number" id="aiCardCount" class="text-input" value="5" min="1" max="50">
                    </div>

                    <div id="aiGenerating" class="ai-generating hidden">
                        <div class="spinner"></div>
                        <p>Generating cards...</p>
                    </div>

                    <div id="aiError" class="hidden" style="padding: 1rem; background: rgba(255, 92, 92, 0.1); border: 1px solid var(--danger); border-radius: var(--radius-md); margin-top: 1rem;">
                        <p style="color: var(--danger); margin: 0;"></p>
                    </div>
                </div>

                <!-- Manual Copy-Paste Tab -->
                <div id="manualTab" class="ai-tab-content">
                    <div class="form-group">
                        <label>Upload or Paste Study Material</label>
                        <div class="file-upload-area">
                            <input type="file" id="manualFileUpload" accept=".txt,.md,.doc,.docx,.pdf" class="hidden">
                            <button id="manualUploadFileBtn" class="btn btn-secondary">
                                <i class="fas fa-upload"></i>
                                Upload File
                            </button>
                            <span id="manualFileName" style="margin-left: 1rem; color: var(--text-secondary);"></span>
                        </div>
                        <textarea id="manualTextInput" class="text-input" rows="8" placeholder="Or paste your study material here..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Number of cards to generate</label>
                        <input type="number" id="manualCardCount" class="text-input" value="5" min="1" max="50">
                    </div>

                    <button id="generatePromptBtn" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                        <i class="fas fa-magic"></i>
                        Generate Prompt
                    </button>

                    <div id="generatedPrompt" class="hidden">
                        <div class="form-group">
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Copy this prompt to your AI</span>
                                <button id="copyPromptBtn" class="btn btn-secondary" style="padding: 0.5rem 1rem;">
                                    <i class="fas fa-copy"></i>
                                    Copy Prompt
                                </button>
                            </label>
                            <textarea id="promptText" class="text-input" rows="6" readonly></textarea>
                        </div>

                        <div class="form-group">
                            <label>Paste AI Response (JSON)</label>
                            <textarea id="aiResponse" class="text-input" rows="8" placeholder='Paste the JSON response from AI here...'></textarea>
                        </div>

                        <button id="importCardsBtn" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-download"></i>
                            Import Cards
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="aiModal">Cancel</button>
                <button id="generateBtn" class="btn btn-primary ai-auto-only">
                    <i class="fas fa-magic"></i>
                    Generate Cards
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module" src="js/firebase-init.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
